define(function(require){require("common"),require("/static/page/course/common/course_common.js"),require("/static/page/course/common/course_collection.js"),require("/static/page/course/common/course_note.js");var a=require("/static/component/base/util/picViewer"),c={praise:"/course/praisenote",cancelPraise:"/course/cancelpraise",collect:"/course/collectnote"},h={};h.praise=function(a,h,v){_this=this,$.ajax({url:c.praise,data:{id:a,mid:h.attr("data-mid")},type:"GET",dataType:"json",success:function(a){if(0==a.result){var c=parseInt(v.text());v.text(c+1),h.addClass("on"),h.find("span").addClass("on icon-thumb-revert praise-anim"),h.attr("title","取消赞")}}})},h.cancel=function(a,h,v){$.ajax({url:c.cancelPraise,data:{id:a,mid:h.attr("data-mid")},type:"POST",dataType:"json",success:function(a){if(0==a.result){var c=parseInt(v.text());v.text(c-1),h.removeClass("on"),h.find("span").attr("class","icon-thumb-revert"),h.attr("title","点赞")}}})},h.collect=function(a,h,v){var g=h.attr("data-mid").split("|");return OP_CONFIG.userInfo&&OP_CONFIG.userInfo.uid==g[1]?void alert('亲亲"'+(OP_CONFIG.userInfo.nickname||"")+'"，别采集自己的笔记哟~！'):void $.ajax({url:c.collect,data:{id:a,mid:g[0]},type:"GET",dataType:"json",success:function(a){if(0==a.result){var c=parseInt(v.text());v.text(c+1),h.addClass("on"),h.find("span").addClass("on icon-star-revert praise-anim"),h.find("i").text("已采集"),h.attr("title","已采集")}}})};var v=window.location.href,g=v.indexOf("own"),j=v.slice(0,v.indexOf("?"));if(-1!=g?($(".tool-right").find(".js-lookme").addClass("on"),-1==v.indexOf("hot")?($(".tool-chk").attr("href",j+"?sort=last&page=1"),$(".tool-left").find("a").eq(0).attr("href",j+"?sort=last&page=1&owner=mine"),$(".tool-left").find("a").eq(1).attr("href",j+"?sort=hot&page=1&owner=mine")):($(".tool-chk").attr("href",j+"?sort=hot&page=1"),$(".tool-left").find("a").eq(0).attr("href",j+"?sort=last&page=1&owner=mine"),$(".tool-left").find("a").eq(1).attr("href",j+"?sort=hot&page=1&owner=mine"))):($(".tool-right").find(".js-lookme").removeClass("on"),-1==v.indexOf("hot")?($(".tool-chk").attr("href",j+"?sort=last&page=1&owner=mine"),$(".tool-left").find("a").eq(0).attr("href",j+"?sort=last&page=1"),$(".tool-left").find("a").eq(1).attr("href",j+"?sort=hot&page=1")):($(".tool-chk").attr("href",j+"?sort=hot&page=1&owner=mine"),$(".tool-left").find("a").eq(0).attr("href",j+"?sort=last&page=1"),$(".tool-left").find("a").eq(1).attr("href",j+"?sort=hot&page=1"))),0==$(".unnote").length){var C=$("#js-note-container").find("li"),_=[];$(C).each(function(a){_.push($(C[a]).attr("id"))});var O=_.join(",");if(0==hasLearn?$(".Jcollect").hide():$(".Jcollect").show(),isLogin){var w=[],I='<a title="编辑此条笔记" href="javascript:;" class="editnote post-action" target="_blank"><i class="icon icon-edit"></i><em>编辑</em></a><a title="删除此条笔记" href="javascript:;" class="delnote post-action" data-cid=""><i class="icon icon-del"></i><em>删除</em></a>';$(C).each(function(a){w.push($(C[a]).attr("authorid"))}),$(w).each(function(a){w[a]==OP_CONFIG.userInfo.uid&&($(C).eq(a).find(".actions textarea").after(I),$(C).eq(a).find(".Jcollect").hide())})}$.ajax({url:"/course/AjaxUserNotesStatus",data:{ids:O},type:"GET",dataType:"json",success:function(a){if(0==a.result){var c=a.data,h=c.collections,v=c.praises;""!=h&&$(_).each(function(a){$(h).each(function(i){if(_[a]==h[i].src_note_id){var c=$(C).eq(a).find(".Jcollect"),v=h[i].collect_num;c.attr("title","已采集").addClass("on").find("i").html("已采集"),c.find("em").text(v)}})}),""!=v&&$(_).each(function(a){$(v).each(function(i){if(_[a]==v[i].note_id){var c=$(C).eq(a).find(".Jpraise"),h=v[i].praise_num;c.attr("title","取消赞").addClass("on").find("i").html("取消赞"),c.find("em").text(h)}})})}}})}$(".Jpraise").on("click",function(){if(!OP_CONFIG.userInfo)return void require.async("login_sns",function(a){a.init()});var a=$(this).closest("li").attr("id"),c=$(this).find("em"),v=$(this);v.hasClass("on")?h.cancel(a,v,c):h.praise(a,v,c)}),$(".Jcollect").on("click",function(){if(!OP_CONFIG.userInfo)return void require.async("login_sns",function(a){a.init()});var a=$(this);if(a.hasClass("on"))return!1;var c=$(this).closest("li").attr("id"),v=$(this).find("em");h.collect(c,a,v)});var k=!1;$(document).off("click.shownotecode").on("click.shownotecode",".js-show-node-code",function(){if(!k){k=!0;var a=$(this).attr("data-id");require.async("./common/view_code",function(c){c.init("/course/viewnotecode",a,{})}),setTimeout(function(){k=!1},1e3)}}),$("#js-note-container").on("click",".js-toggle-content",function(e){var a=$(this),c=a.attr("data-state");"expanded"===c?a.text("[ 查看全文 ]").attr("data-state","collapsed").parent().css({position:"absolute"}).closest(".js-notelist-content").css({maxHeight:"168px"}):a.text("[ 收起全文 ]").attr("data-state","expanded").parent().css({position:"static"}).closest(".js-notelist-content").css({maxHeight:"none"}),e.preventDefault()}).on("mouseenter",".js-toggle-notelist",function(){$(this).hasClass("hover")||($(this).addClass("hover"),$(this).find(".slider-door").animate({margin:0},300))}).on("mouseleave",".js-toggle-notelist",function(){$(this).hasClass("hover")&&($(this).removeClass("hover"),$(this).find(".catch-pic").animate({marginLeft:"-50%"},300),$(this).find(".catch-video").animate({marginRight:"-50%"},300))}).on("click",".js-catch-pic",function(){if($(this).hasClass("js-catch-pic")){var c=$(this).closest(".js-toggle-notelist").find("img").data("src");a.create(c)}})});