define(function(require){require("common"),require("/static/lib/ueditor/ueditor.parse.js"),require("/static/page/wenda/index.js"),require("/static/lib/layer/1.6.0/layer.min.js"),require("/static/lib/layer/1.6.0/skin/layer.css"),require("/static/component/base/util/launchAPP");var a=require("/static/page/wenda/detail-common"),c=!1;a.isPhone()&&a.topbanner("wendaId="+quesInfo.quesid),uParse("body",{rootPath:"/static/component/base/ueditor/",chartContainerHeight:500});var h={msg:function(a,c){var h=$(this).closest(".js-msg-context"),m=a?"addClass":"removeClass",v=c?"qa-tips-ok":"qa-tips-error";h.find(".qa-tips").removeClass("qa-tips-ok qa-tips-error")[m](v).html(a||"")},error:function(a,c){arguments.length<2&&(c=a,a=$(this).next(".errortip")),c?$(a).html(c):$(a).empty()}},v={initialFrameHeight:100},g=UE.getEditor("js-reply-editor-box",v);OP_CONFIG.userInfo?$("#answer-frame").click(function(){$("#avator-wrap,#js-reply-wrap").removeClass("answer-hidden"),$("#add-answer").hide(),setTimeout(function(){g.focus()},100)}):(g.addListener("ready",function(){g.setDisabled("fullscreen")}),$("#answer-frame").click(function(){seajs.use("login_sns",function(a){a.init()})}));var j=$(".pop-tips-layer"),w=function(){var a=-(parseInt(j.width())+2)/2+"px",c=-(parseInt(j.height())+2)/2+"px";j.css({marginLeft:a,marginTop:c,"z-index":"100000"}),setTimeout(function(){j.hide()},2e3)};$(".none_ans")[0]&&quesInfo.answeruid===quesInfo.quesuid&&$.ajax({url:"/wenda/questioninvite",data:{quesId:quesInfo.quesid},dataType:"json",success:function(c){if(1==c.result&&c.data.length>0){var h=a.recommenddom(c.data);$(".none_ans").after(h)}}}),$("#main").on("click",".js-rebtn",function(){var a=this,c=$(this).attr("data-uid");$.ajax({url:"/wenda/askpeople",type:"post",dataType:"json",data:{quesId:quesInfo.quesid,inviteUid:c},success:function(c){1==c.result?($(a).html("已邀请").addClass("b_de1").removeClass("js-rebtn"),$(j).html('<i class="icon-tick2"></i> 邀请成功').show(),w()):-11==c.result?require("/static/component/logic/login/login-regist").init():($(j).html('<i class="icon-point-revert"></i> 邀请失败').show(),w())}})}),g.addListener("focus",function(){h.msg.call($("#js-reply-editor-box"))}),$(".js-solved").on("click",function(){if(!c){c=!0;var a=$(this),h={},v=a.data("quesid"),g=a.data("replyid");h.ques_id=v,h.reply_id=g,$.ajax({url:"/wenda/adoptreply",type:"post",dataType:"json",data:h,success:function(c){return 0!=c.result?-6==c.result?($(j).html('<i class="icon-point-revert"></i> 该问题已有答案被采纳').show(),void w()):void 0:(a.removeClass("js-solved").addClass("had-solve").text("已被提问者采纳"),void setTimeout(function(){location.reload()},1e3))},complete:function(){c=!1}})}}),$("#js-qa-wenda a").attr("target","_blank"),$(".qa-comment-c a").attr("target","_blank"),$("#js-wenda-ci-submit").click(function(e){e.preventDefault();var c,v,g,y,C,b=$(this);if(!b.hasClass("disabled")){if(C=UE.getEditor("js-reply-editor-box").getContent(),g={},$.trim(UE.getEditor("js-reply-editor-box").getContentTxt()).length<3)return void h.msg.call(b,"回答字数不少于3个！");if(C.length>2e4)return void h.msg.call(b,"回答字数不大于20000个！");if(c=$("#js-qa-ci-footer"),(v=c.find(".verify-code")).length){if(y=v.find("input").val(),0==y.length)return void h.msg.call(this,"请输入验证码");g.verify_code=y}g.content=C,g.ques_id=b.attr("data-qid"),h.msg.call(this),b.addClass("disabled").text("回答..."),$.ajax({url:"/wenda/savereply",type:"post",dataType:"json",data:g,success:function(h){if(0==h.result)$(j).html('<i class="icon-tick2"></i> 回答成功').show(),w(),setTimeout(function(){location.href=h.data},1e3);else{if(1e3==h.result)return $(j).html('<i class="icon-tick2"></i> 回答成功，审核通过后才能显示').show(),w(),void setTimeout(function(){window.location.reload()},2e3);if(1===h.data&&-1===h.result){if(c.find(".verify-code").length)return;return c.prepend(a.getVerifyCodeBlock()),$(j).html('<i class="icon-point-revert"></i> 请输入验证码').show(),w(),void b.removeClass("disabled").text("回答")}$(j).html('<i class="icon-point-revert"></i>'+h.msg||"发布失败").show(),w(),b.removeClass("disabled").text("回答"),c.find(".verify-code-around").trigger("click")}},error:function(){b.removeClass("disabled").text("回答")},complete:function(){}})}}),$(document).on("click",".js-del",function(){var a=$(this).data("id"),c=$(this).data("type"),h=["","提问","回答","回复"];confirm("确认删除此"+h[c]+"?")&&$.ajax({url:"/wenda/wddelete",data:{id:a,type:c},dataType:"json",type:"GET",success:function(a){0==a.result?($(j).html('<i class="icon-tick2"></i> 删除成功！').show(),w(),setTimeout(function(){location.reload()},1e3)):alert("删除失败!")}})});var y,C=function(a){return a.replace(/[^\x00-\xff]/g,"__").length},b=function(){var a,c=$(this);return C(a=$.trim(c.val()))<10?(c.addClass("ipt-error"),h.error.call(this,"标题不能少于5个汉字！"),!1):C(a)>100?(c.addClass("ipt-error"),h.error.call(this,"标题不能大于50个汉字！"),!1):(c.removeClass("ipt-error"),void h.error.call(this,""))};$("#js-wenda-editor-title").blur(b),$("#js-edit").click(function(){var a,c=$("#js-content-main");$("#js-wenda-editor").is(":visible")||(c.hide(),$("#js-wenda-editor-title").val(c.find(".js-qa-wenda-title").text()),y||(y=1,a=UE.getEditor("js-wenda-editor-content"),a.addListener("ready",function(){y=2,UE.getEditor("js-wenda-editor-content").setContent($("#js-editor-content-dup").html())}),a.addListener("focus",function(){h.msg.call($("#js-wenda-editor"))})),2==y&&UE.getEditor("js-wenda-editor-content").setContent($("#js-editor-content-dup").html()),$("#js-wenda-editor").show())}),$("#js-tags").on("click",".save-list-tag",function(){{var a=$(this);a.attr("data-id")}if(a.hasClass("onactive"))a.removeClass("onactive");else{if($("#js-tags .onactive").length>2)return;a.addClass("onactive")}}),$("#js-wenda-editor-cancel").click(function(){$("#js-wenda-editor").hide(),$("#js-content-main").show()}),$("#js-wenda-editor-submit").click(function(){var a,c,v,g=$(this);if(!g.hasClass("disabled")&&b.call($("#js-wenda-editor-title"))!==!1){if(a=$("#js-wenda-editor-title").val(),c=UE.getEditor("js-wenda-editor-content").getContent(),v=$.trim(UE.getEditor("js-wenda-editor-content").getContentTxt()).length,v||(c=""),c.length>2e4)return void h.error("#js-wenda-editor-content .errortip","超过字数上限，最多输入20000字");if(0==$("#js-tags .onactive").length)return void h.error("#js-tags ~ .errortip","问题至少选择1个分类");h.error("#js-tags ~ .errortip","");var y=[];$("#js-tags .onactive").each(function(a,c){y.push($(c).attr("data-id"))}),g.addClass("disabled").text("保存..."),$.ajax({url:"/wenda/editwenda",data:{title:a,content:c,id:g.attr("data-id"),label_ids:y.join(",")},dataType:"json",type:"post",success:function(a){0==a.result?($(j).html('<i class="icon-tick2"></i> 修改成功！').show(),w(),setTimeout(function(){location.reload()},1e3)):h.msg.call(g,a.msg)},error:function(){h.msg.call(g,"服务错误，请稍后重试！")},complete:function(){g.removeClass("disabled").text("保存")}})}});var c=0;$(".js-collection-btn").on("click",function(){function a(){require.async("login_sns",function(a){a.init()})}if(!OP_CONFIG.userInfo)return void a();if(!c){c=1;var h=$(this),v=h.attr("data-id"),g=h.find(".js-detail-follow"),j="add";"取消关注"===h.attr("title")&&(j="del");var w="/wenda/wendafollow";$.ajax({type:"get",url:w,dataType:"json",data:{bbsId:v,act:j},success:function(a){c=0,0==a.result?"add"==j?(h.attr("title","取消关注").find("i").removeClass("icon-heart").addClass("icon-heart-revert"),g.text(0==g.text().length?"1":parseInt(g.text())+1)):(h.attr("title","关注").find("i").removeClass("icon-heart-revert").addClass("icon-heart"),g.text(g.text()-1==0?"":parseInt(g.text())-1)):layer.msg("操作失败，请稍后再试",1,1)},error:function(){layer.msg("网络错误，请稍后再试",1,1),c=0}})}}),$(document).on("click",".js-edit",function(){var a=$(this).closest(".ques-answer"),c=$(this).data("id");a.addClass("edit-box"),a.find(".js-wenda-tool").hide(),a.find(".detail-r").hide(),a.find(".js-reply-tool").show(),a.find(".rich-text").hide(),a.find(".reply-textarea").show();var h="";$("#reply-textarea-"+c).hasClass("edui-imooc")?(h=UE.getEditor("reply-textarea-"+c),h.setContent(h.options.initialContent)):h=UE.getEditor("reply-textarea-"+c,{initialFrameHeight:100,initialFrameWidth:652}),setTimeout(function(){h.focus()},100)}).on("click",".js-reply-cancel",function(){var a=$(this).closest(".ques-answer");a.removeClass("edit-box"),a.find(".detail-r").show(),a.find(".js-wenda-tool").show(),a.find(".js-reply-tool").hide(),a.find(".rich-text").show(),a.find(".reply-textarea").hide()}).on("click",".js-reply-submit",function(e){e.preventDefault();var c,v,g,y,C,b=$(this),k=(b.closest(".ques-answer"),b.data("id")),E=UE.getEditor("reply-textarea-"+k);if(!b.hasClass("disabled")){if(C=E.getContent(),g={},$.trim(E.getContentTxt()).length<3)return void h.msg.call(b,"回答字数不少于3个！");if(C.length>2e4)return void h.msg.call(b,"回答字数不大于20000个！");if(c=b.parents(".js-msg-context"),(v=c.find(".verify-code")).length){if(y=v.find("input").val(),0==y.length)return void h.msg.call(this,"请输入验证码");g.verify_code=y}g.content=C,g.reply_id=k,h.msg.call(this),b.addClass("disabled").text("保存..."),$.ajax({url:"/wenda/ajaxeditreply",type:"post",dataType:"json",data:g,success:function(h){if(0==h.result)$(j).html('<i class="icon-tick2"></i> 保存成功').show(),w(),setTimeout(function(){location.href=h.data},1e3);else{if(1===h.data&&-1===h.result){if(c.find(".verify-code").length)return;return c.prepend(a.getVerifyCodeBlock()),$(j).html('<i class="icon-point-revert"></i> 请输入验证码').show(),void w()}$(j).html('<i class="icon-point-revert"></i>'+h.msg).show(),w(),c.find(".verify-code-around").trigger("click")}},complete:function(){b.removeClass("disabled").text("保存")}})}});var k=window.location.href.split("page=");k.length>1&&(k=k[1].split("&")[0],1!=k&&$("html,body").animate({scrollTop:$(".ans_num").offset().top},0))});