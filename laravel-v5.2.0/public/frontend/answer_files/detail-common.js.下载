define(function(require){require("/static/lib/autosize/jquery.autosize.min.js"),require("/static/component/base/util/modal.button.js");var a=require("/static/component/base/util/launchAPP"),c={clearInput:function(){},isPhone:function(){for(var a=navigator.userAgent,c=["Android","iPhone","iPod"],h=!1,i=0;i<c.length;i++)if(a.indexOf(c[i])>-1){h=!0;break}return h},topbanner:function(c){str="",str+='<div class="toapp-banner ">',str+='<a id="js-toapp" data-search="'+c+'" href="javascript:;">',str+='<img src="/wap/img/banner.jpg?1" width="100%">',str+="</a>",str+='<span id="js-toapp-close">×</span>',str+="</div>",$("body").prepend(str),a.init()},recommenddom:function(a){var c="";c+="<div class='recommend-box'>",c+="<p>这些网友或许可以解决问题:</p>",c+="<ul class='clearfix'>";for(var i=0;i<a.length;i++)c+=i==a.length-1?"<li style='margin-right: 0;'>":"<li>",c+="<a target='_blank' href='/u/"+a[i].user.uid+"/bbs'><img src='"+a[i].user.img+"' /></a>",c+="<span class='re-name'>",c+="<a title='"+a[i].user.nickname+"' target='_blank' href='/u/"+a[i].user.uid+"/bbs'>"+a[i].user.nickname+"</a>",c+="</span>",c+="<div class='re-cont'>一周内在"+a[i].label.name+"下回答了"+a[i].label.answers+"个问题</div>",c+=1==a[i].is_invited?"<span class='re-btn b_de1' data-uid='"+a[i].user.uid+"'>已邀请</span>":"<span class='re-btn js-rebtn b_43c' data-uid='"+a[i].user.uid+"'>邀请Ta回答</span>",c+="</li>";return c+="</ul>",c+="</div>"},clearInputDefault:function(){var a=$(this);a.closest(".qa-reply-ibox-default").find("textarea").val("").blur(),$(this).closest(".qa-reply-ifoot").hide()},msg:function(a,c){var h=$(this).closest(".qa-reply-ifoot"),m=a?"addClass":"removeClass",v=c?"qa-tips-ok":"qa-tips-error";h.find(".qa-tips").removeClass("qa-tips-ok qa-tips-error")[m](v).html(a||"")},msgComment:function(a,c){var h=$(this).closest(".js-msg-context"),m=a?"addClass":"removeClass",v=c?"qa-tips-ok":"qa-tips-error";h.find(".qa-tips").removeClass("qa-tips-ok qa-tips-error")[m](v).html(a||"")},extendPostData:function(a){a.is_old="qadetail"==OP_CONFIG.page?1:0},isWenda:function(){return"wenda"==OP_CONFIG.module&&"detail"==OP_CONFIG.page},getReplyBlock:function(){return this.replyStr||(this.replyStr=$("#reply-box").html().replace(/(<textarea[^>]*>).*?(<\/textarea>)/,"$1$2"),$("#reply-box").remove()),this.replyStr},getVerifyCodeBlock:function(){return['<div class="verify-code l">','<input type="text" maxlength="4" class="verify-code-ipt" placeholder="请输入验证码">','<a class="verify-img-wrap js-verify-refresh" hidefocus="true" href="javascript:void(0)"><img class="verify-img" src="/wenda/getverifycode?',Math.random(),'"></a>','<a class="icon-refresh js-verify-refresh" hidefocus="true" href="javascript:void(0)"></a>',"</div>"].join("")},getReplyTextBlock:function(){return this.replyTextStr||(this.replyTextStr=['<div class="qa-reply-item" data-rid="{reply_id}">','<a class="qa-reply-item-author" href="/u/{from_uid}/courses" title="{from_username}">','<img src="{from_pic}">',"</a>",'<div class="qa-reply-item-inner">',"<p>{usertype}",'<a href="/u/{from_uid}/courses" class="qa-reply-nick">{from_username}</a> ',"{toUsername}</p>",'<p class="q-reply-item-c">{description}</p>','<div class="qa-reply-item-foot">',"<span>{create_time}</span>",'<span class="qa-reply-item-reply js-reply-item-reply" data-uid="{from_uid}|{from_username}"><i class="icon-resp"></i>回复</span>',"</div>","</div>","</div>"].join(""))},getReplyHtml:function(a){var c=this.getReplyTextBlock(),h=this.modifer;return c=c.replace(/\{(\w+?)\}/g,function(s,c){return h[c]?h[c](a):a[c]||""})},modifer:{usertype:function(a){return 2==a.from_usertype?'<span class="qa-icon"></span>':""},toUsername:function(a){return a.to_username?'回复 <a href="/u/'+a.to_uid+'/courses" class="qa-reply-nick">'+a.to_username+"：</a>":""},description:function(a){return a.description.replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br>$2")}},getEditBlock:function(){},escape:function(a){return a.replace(/[<>]/g,function(){})},showSupported:function(){var a,h=$(this),v=h.offset(),y=15,g=-17;a=c.getSupportedContainer(),a.css({left:v.left+y+h.width(),top:v.top+g}).fadeIn("fast"),a.find("supported-inner").html("正在加载..."),c.loadSupported(h.attr("data-ids").split("-")[1])},loadSupported:function(a){var h=this;this.supportedXhr&&this.supportedXhr.abort(),this.supportedXhr=$.ajax({url:"/wenda/getsupplynick",data:{id:a,r:Math.random()},dataType:"json",success:function(a){var v="";h.supportedXhr=null,0==a.result?($.each(a.data,function(a,c){v+='<a href="/u/'+c.uid+'/courses" target="_blank"><img src="'+c.img+'" /></a>'}),v=v||"还没有人赞过哦~~"):v=a.msg,c.getSupportedContainer().find(".supported-inner").html(v)}})},getSupportedContainer:function(){var a=$("#supported-nick-container");return a.length||(a=$("<div id='supported-nick-container' class='supported-container js-supported-container'><h2>最近赞过的人</h2><div class='supported-inner'></div><div class='supported-arrow'><i></i></div></div>"),$(document.body).append(a)),a},hideSupported:function(){c.getSupportedContainer().fadeOut("fast")}},h=function(a){var m=$(".correct-layer");m.length||($("body").append('<div class="correct-layer">                <h3>采纳答案成功！</h3>                <p>向帮助你的同学说点啥吧！感谢那些助人为乐的人</p>                <input type="text" value="非常感谢！" /><a href="javascript:void(0)" class="btn-submit">提交</a>                <button aria-hidden="true" hidefocus="true" data-dismiss="modal" class="btn-close" type="button"></button>            </div>'),m=$(".correct-layer"),m.on("shown",function(){$(".correct-layer .btn-submit").on("click",function(){if(!$(this).hasClass("isloading")){var h=$(".correct-layer input").val();if(0==h.length)return void window.location.reload();if(h.strLen()>40)return void $(".correct-layer input").focus().addClass("error");var v={description:h,reply_id:a};c.extendPostData(v),$(this).addClass("isloading"),$.post("/wenda/savereplycomment",v,function(){window.location.reload()})}}),$(".correct-layer input").on("keyup",function(){var a=$(".correct-layer input").val();a.strLen()>40?$(".correct-layer input").addClass("error"):$(".correct-layer input").removeClass("error")})}).on("hidden",function(){$(this).remove()})),m.modal("show")},v=document.createElement("input");"placeholder"in v||$(document).on("focusout","#main [placeholder]",function(){var a=$(this);a.val().length||a.val(a.attr("placeholder")).addClass("placeholder")}).on("focusin","#main [placeholder]",function(){var a=$(this);a.val()==a.attr("placeholder")&&a.hasClass("placeholder")&&a.val("").removeClass("placeholder")});var y,g;return $(document).on("click",".js-reply-unlogin",function(){if(1==isLogin){{var a,c=$(this),h=c.closest(".js-qa-comment");h.attr("data-cid")}h.find(".js-qa-reply-ibox").show().find("textarea"),c.attr("data-uid")?(us=c.attr("data-uid").split("|"),h.find(".js-qa-reply-ibox").find("textarea").focus().val("回复 "+us[1]+"："),h.find(".js-qa-reply-ibox").attr("data-tuid",us[0])):h.find(".js-qa-reply-ibox").find("textarea").focus().val(""),a=h.find(".js-qa-reply-ibox").offset(),$("html,body").animate({scrollTop:a.top-$(window).height()/3})}else $(".js-unlogin").trigger("click")}),$(document).on("click",".js-unlogin",function(){seajs.use("login_sns",function(a){a.init()})}).on("click",".js-qa-comment-support",function(){var a,h,v=$(this);v.hasClass("qa-comment-supported")||(v.addClass("qa-comment-supported"),h={},a=v.attr("data-ids").split("-"),c.isWenda()?(h.ques_id=a[0],h.reply_id=a[1]):h.id=a[1],$.ajax({url:c.isWenda()?"/wenda/supportreply":"/course/ajaxaddreplynum",data:h,type:"POST",dataType:"json",success:function(a){var c,h;"0"==a.result&&(c=v.find("span"),h=v.find("i"),c.text(+c.text()+1),h.addClass("on icon-thumb-revert praise-anim"))}}))}).on("click.accept",".js-qa-comment-accept",function(){var a,v,y=$(this);y.hasClass("loading")||(a=y.attr("data-ids").split("-"),v={},v[c.isWenda()?"ques_id":"qid"]=a[0],v[c.isWenda()?"reply_id":"aid"]=a[1],$.ajax({url:c.isWenda()?"/wenda/adoptreply":"/course/ajaxadoptanswer",data:v,dataType:"json",type:"post",success:function(c){0==c.result&&(y.addClass("qa-comment-correct").removeClass("qa-comment-accept"),$(document).off("click.accept"),h(a[1]))}}))}).on("mouseenter",".js-qacom-supported-user",function(){$(this);clearTimeout(y),y=setTimeout($.proxy(c.showSupported,this),1e3)}).on("mouseleave",".js-qacom-supported-user",function(){clearTimeout(g),clearTimeout(y),g=setTimeout(c.hideSupported,300)}).on("mouseenter",".js-supported-container",function(){clearTimeout(g)}).on("mouseleave",".js-supported-container",function(){g=setTimeout(c.hideSupported,200)}).on("click",".js-reply-item-reply",function(){{var a,c=$(this),h=c.closest(".js-qa-comment");h.attr("data-cid")}h.find(".js-qa-reply-ibox").show().find("textarea"),c.attr("data-uid")?(us=c.attr("data-uid").split("|"),h.find(".js-qa-reply-ibox").find("textarea").focus().val("回复 "+us[1]+"："),h.find(".js-qa-reply-ibox").attr("data-tuid",us[0])):h.find(".js-qa-reply-ibox").find("textarea").focus().val(""),a=h.find(".js-qa-reply-ibox").offset(),$("html,body").animate({scrollTop:a.top-$(window).height()/3})}).on("click",".js-overplus-num",function(){var a,h=$(this);a={reply_id:h.attr("data-rid"),ques_uid:h.attr("data-uid"),page:(+h.attr("data-page")||1)+1},c.extendPostData(a),$.ajax({url:"/wenda/getcomment",data:a,success:function(a){var c=h.parent();c.append(a),h.remove()}})}).on("click",".js-ipt-cancel",function(){var a=$(this).closest(".js-qa-reply-ibox");a.hide()}).on("click",".js-ipt-submit",function(){var a,h,v,y,g,j,b,k,_=$(this),C=_.closest(".js-qa-comment"),w=_.closest(".js-qa-reply-ibox");if(y={},!_.hasClass("disabled")){if(g=(v=w.find(".js-reply-ipt-default")).val(),g=$.trim(g),b=w.attr("data-tuid"),a=/^回复\s*\S+：/,b&&a.test(g)&&(g=g.replace(a,""),y.from_uid=b),0==g.length||g==v.attr("placeholder"))return void c.msg.call(this,"请输入回复内容");if(g.length<3)return void c.msg.call(this,"回复字数不小于3个");if(k=c.isWenda()?2e3:300,g.length>k)return void c.msg.call(this,"回复字数不大于"+k+"个");if((h=w.find(".verify-code")).length){if(j=h.find("input").val(),0==j.length)return void c.msg.call(this,"请输入验证码");y.verify_code=j}c.msg.call(this),C.find(".verify-code").find("input").val(""),y.description=g,y.reply_id=C.attr("data-cid"),c.extendPostData(y),_.addClass("disabled").text("提交..."),$.ajax({url:"/wenda/savereplycomment",type:"post",data:y,dataType:"json",success:function(a){var h=w.find(".qa-reply-ifoot");if(0==a.result){if(C.find(".js-reminds-num").length>0)C.find(".js-reminds-num").text(1*C.find(".js-reminds-num").text()+1);else if(3==C.find(".qa-reply-item").length)C.find(".qa-reply-c").append('<div class="overplusnum js-overplus-num" data-rid="'+C.attr("data-cid")+'">点击展开后面<em class="js-reminds-num">1</em>条评论</div>');else{var v=c.getReplyHtml(a.data),y=C.find(".qa-reply-c").append(v).find(".qa-reply-item:last").offset();$("html,body").animate({scrollTop:y.top-$(window).height()/3})}c.msg.call(_),w.hide(),$(".verify-code img").each(function(){var a=$(this);a.attr("src",a.attr("src").replace(/\?[\d\.]*$/,"?"+Math.random()))})}else if(1e3==a.result)$.alert("回复成功，审核通过后才能显示"),w.hide();else{if(-1==a.result&&1===a.data){if(h.find(".verify-code").length)return;return h.prepend(c.getVerifyCodeBlock()),void c.msg.call(_,"请输入验证码")}c.msg.call(_,a.msg),h.find(".verify-code-around").trigger("click")}},complete:function(){_.removeClass("disabled").text("提交")}})}}),$(document).on("click",".js-verify-refresh",function(){var a=$(".verify-img");a.attr("src",a.attr("src").replace(/\?\S*/,"?"+Math.random()))}),c});