seajs.config({paths:{cptbase:"/static/component/base"}}),seajs.use(["cptbase/placeholder/placeholder.js","cptbase/util/modal.button.js","cptbase/util/validate.js"],function(){function a(a){var c=/^[\w~`!@#$%&*.()_+<>?:"'+*\/\-\^\\\][{}]{6,16}$/;return c.test(a)?!0:!1}function c(a){var c=/^\d{4}$/;return c.test(a)?!0:!1}function v(a){return $error=$(a),function(a){var a=a||"";method=a?"addClass":"removeClass",$error[method]("tips-error").html(a)}}var h,j,g='<div id="signin" class="rl-modal ">         <div class="fgtpaw-wrap">                        <h2>忘记密码</h2>                    </div>                    <div class="link-info">                        <h3>短信验证码已发送至<span class="color-red js-phoneNumber"></span></h3>                    </div>          <div class="rl-modal-body phoneVerityBox">            <form id="signup-form">                <p id="ggerr" class="subtitle err color-red"></p>                <div class="rlf-group pr">                    <input type="text" tabindex="1" class="js-phoneVerity ipt ipt-pwd" maxlength="4" placeholder="请输入短信验证码"/>                    <p class="reSend pa">重新发送<span class="js-second">60</span></p>                    <p class="rlf-tip-wrap color-red" id="error-phoneVerity"></p>                </div>                <div class="rlf-group proclaim-loc js-pwdWrap js-proclaim-on pr">                    <a href="javascript:void(0)" hidefocus="true" class="proclaim-btn js-proclaim icon-show-pw is-pwd"></a>                    <input type="password" id="js-password" name="password"  data-validate="password" class="ipt ipt-pwd js-pass-pwd" placeholder="6-16位密码，区分大小写，不能用空格" maxlength="16" tabindex="2"/>                    <!--ie8 hack-->                    <input type="text" tabindex="3" name="password"  data-validate="password" class="ipt ipt-pwd js-txt-pwd" placeholder="6-16位密码，区分大小写，不能用空格" maxlength="16"/>                    <p class="rlf-tip-wrap color-red" id="error-password"></p>                </div>                <div class="rlf-group clearfix">                    <input  type="button" id="submit-btn" value="提交" hidefocus="true" class="btn-red btn-full r"/>                </div>                <p class="backNotify js-back"  data-fromto="signin:signup">返回修改手机号 </p>            </form>          </div>                 </div>         ',w='<div id="signin" class="rl-modal ">          <div class="rl-modal-body phoneVerityBox">            <form id="signup-form">                <i class="s-right icon-tick-revert"></i>                <p class="title">恭喜你！密码设置成功</p>                               <div class="rlf-group clearfix finished_wrap">                    <input  type="button" id="submit-btn" value="返回首页[5]" hidefocus="true" class="btn-red btn-finished js-finshed js-finishSecond"/>                </div>            </form>          </div>        </div>        ';$(function(){$(document).delegate(".js-proclaim","click",function(){pwdPass=$(".js-pass-pwd"),protxt=$(".js-txt-pwd"),proclaimBtn=$(".js-proclaim"),proclaimCode=function(){if(proclaimBtn.hasClass("is-pwd")){var a=pwdPass.val();protxt.val(a),proclaimBtn.parent().removeClass("js-proclaim-on").addClass("js-proclaim-off"),proclaimBtn.removeClass("is-pwd")}else{var a=protxt.val();pwdPass.val(a),proclaimBtn.parent().removeClass("js-proclaim-off").addClass("js-proclaim-on"),proclaimBtn.addClass("is-pwd")}},proclaimCode()}),$("#main").on("blur",".js-pass-pwd",function(){var a=this.value;$(".js-txt-pwd").val($.trim(a))}),$("#main").on("blur",".js-txt-pwd",function(){var a=this.value;$(".js-pass-pwd").val($.trim(a))}),$(document).on("click",".phoneVerityBox .js-back",function(){window.location.reload()}).on("click",".js-finshed",function(){window.location.href="/user/newlogin/from_url/"}).on("click"," .js-reSend",function(){$.ajax({url:"/passport/user/resetpass",data:h,method:"post",dataType:"json",success:function(a){if(10001==a.status){var c=60;clearInterval(j),j=setInterval(function(){$(".js-second").parent().removeClass("js-reSend"),$(".js-second").parent().removeClass("active"),$(".js-second").html(c),0==c&&($(".js-second").parent().addClass("active"),$(".js-second").parent().addClass("js-reSend"),$(".js-second").html(""),clearInterval(j)),c--},1e3)}else $("#ggerr").html(a.msg)},error:function(){$("#js-g-forgot-error").addClass("rlf-tip-error").html("服务错误，稍后重试")}})}).on("click","#submit-btn",function(){$("#error-phoneVerity").html(""),$("#error-password").html(""),$("#js-g-forgot-error").html(""),$("#ggerr").html("");var v=$.trim($("#js-password").val()),h=$.trim($(".js-phoneVerity").val());if(h.length<1)return void $("#error-phoneVerity").html("短信验证码不能为空");if(v.length<1)return void $("#error-password").html("密码不能为空");if(!c(h))return void $("#error-phoneVerity").html("请输入4位短信验证码");if(!a(v))return void $("#error-password").html("请输入6-16位密码，区分大小写，不能使用空格！");$("#ggerr").html("");({number:$(".js-phoneNumber").html(),mobileverify:$(".js-phoneVerity").val(),password:$("#js-password").val(),type:1});$.ajax({url:"/passport/user/resetpass",data:{password:v,mobileverify:h,type:1},method:"post",dataType:"json",success:function(a){if(10001!=a.status)return void $("#ggerr").html(a.msg);var c=5;$(".page-forgotpwd-wrap").html(w),clearInterval(j),j=setInterval(function(){$(".js-finishSecond").val("返回首页["+c+"]"),1>c&&(window.location.href="/user/newlogin/from_url/",clearInterval(j)),c--},1e3)},error:function(){$("#js-g-forgot-error").addClass("rlf-tip-error").html("服务错误，稍后重试")}})})});var b=function(a){var c=a||"/user/getcode",v=$("#js-forgot-form");c="/passport/user/verifycode?",v.find(".verify-img").attr("src",c+(new Date).getTime())};b(),$(".js-change-verify-code").on("click",function(){b()});var y=v("#js-g-forgot-error"),C="sohu.com::http://mail.sohu.com                         |sina.com,sina.cn :: http://mail.sina.com                         |vip.sina.com :: http://vip.sina.com.cn                         |126.com :: http://www.126.com                         |163.com :: http://mail.163.com                         |vip.163.com :: http://vip.163.com                         |vip.126.com :: http://vip.126.com                         |qq.com,vip.qq.com :: http://mail.qq.com                         |msn.com,outlook.com,hotmail.com,live.cn,live.com :: http://outlook.com                         |gmail.com :: http://www.gmail.com                         |yahoo.com.cn,yahoo.cn,aliyun.com :: http://mail.aliyun.com                         |yahoo.com.tw :: http://mail.yahoo.com.tw                         |21cn.com :: http://mail.21cn.com                         |tom.com :: http://mail.tom.com/ ",k={};$.each(C.split("|"),function(a,c){var i,v,h=c.split("::"),c=$.trim(h[1]);for(h=h[0].split(","),i=0,v=h.length;v>i;i++)k[$.trim(h[i])]=c}),$("#js-forgot-form").on("blur",".ipt-email",function(){this.value=$.trim(this.value)}),$("#js-forgot-form input").placeholder(),$("#js-forgot-form").validateSetup({fields:{verify:{rules:[{rule:function(a,c){return/[a-zA-Z0-9]{4}/.test(c)?void 0:"请输入正确的验证码！"}}]}},onerror:function(e){e._relateField&&e.tip&&$(e._relateField).addClass("ipt-error").siblings(".tips").html(e.tip).addClass("tips-error"),y()},onvalid:function(e){e._relateField&&$(e._relateField).removeClass("ipt-error").siblings(".tips").removeClass("tips-error").empty(),y()}}),$("#js-forgot-submit").button({loadingText:"正在提交..."}).on("click",function(){var a=$(this);a.hasClass("disabled")||($("#js-g-forgot-error").val(""),a.button("loading"),a.closest("form").validate({success:function(a){if(a.email.indexOf("@")>=0)$.ajax({url:"/passport/user/emailresetpass",data:{useremail:a.email,verify:a.verify},method:"post",dataType:"json",success:function(c){{var v;window.location}10001===c.status?($(".js-forgotpwd-form-wrap").hide(),$(".xa-email").text(a.email),(v=k[a.email.match(/[^@]*$/)[0]])&&$(".js-email-add").attr({href:v,target:"_blank"}),$(".js-forgot-result").show()):(y(c.msg||""),b(),$("#verify-ipt").val(""),$("#js-forgot-submit").button("reset"))},error:function(){y("服务错误，稍后重试")}});else{var c={number:a.email,verify:a.verify};h=c,$.ajax({url:"/passport/user/resetpass",data:c,method:"post",dataType:"json",success:function(a){if(10001==a.status){$(".page-forgotpwd-wrap").html(g),$(".js-phoneNumber").html(c.number);var v=60;clearInterval(j),j=setInterval(function(){$(".js-second").parent().removeClass("js-reSend"),$(".js-second").parent().removeClass("active"),$(".js-second").html(v),1>v&&($(".js-second").parent().addClass("active"),$(".js-second").parent().addClass("js-reSend"),$(".js-second").html(""),clearInterval(j)),v--},1e3)}else $("#js-forgot-submit").html("提交").removeAttr("disabled").removeClass("disabled"),$("#js-g-forgot-error").addClass("rlf-tip-error").html(a.msg)},error:function(){$("#js-g-forgot-error").addClass("rlf-tip-error").html("服务错误，稍后重试")}})}},error:function(){setTimeout('$("#js-forgot-submit").button("reset")',1)}}))})});